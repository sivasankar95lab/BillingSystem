<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Billing System</title>
    
    <!-- Load jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* ==================== RESET & BASE STYLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* ==================== LOGIN SCREEN STYLES ==================== */
        #loginScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-box h2 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        .login-box input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .login-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-box button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }

        /* ==================== MAIN APPLICATION STYLES ==================== */
        #mainApp {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ==================== MODAL STYLES ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 24px;
        }

        .close-modal {
            font-size: 30px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group small {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 12px;
        }

        .logo-preview {
            margin-top: 10px;
            text-align: center;
        }

        .logo-preview img {
            max-width: 150px;
            max-height: 150px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
        }

        /* ==================== HEADER & NAVIGATION ==================== */
        header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        /* ==================== COMPANY SELECTOR ==================== */
        .company-selector {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .company-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .company-selector h3 {
            color: #333;
        }

        .company-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .company-selector select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ==================== GST SETTINGS ==================== */
        .gst-settings {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .gst-settings h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .gst-input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .gst-input-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .gst-input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .gst-input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ==================== BILL CONTAINER ==================== */
        #billContainer {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 0 auto;
        }

        .company-header {
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .company-logo {
            max-width: 150px;
            max-height: 100px;
            margin-bottom: 15px;
        }

        .company-name {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .company-details {
            color: #666;
            line-height: 1.8;
            font-size: 14px;
        }

        .bill-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .info-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .info-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .info-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .customer-section {
            margin-bottom: 30px;
        }

        .customer-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .items-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .items-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .items-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        .items-table input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-add-item {
            background: #4caf50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-add-item:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-remove {
            background: #e74c3c;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-remove:hover {
            background: #c0392b;
        }

        /* ==================== DISCOUNT SECTION ==================== */
        .discount-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .discount-section h4 {
            color: #856404;
            margin-bottom: 15px;
        }

        .discount-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .discount-controls label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .discount-controls input,
        .discount-controls select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .discount-controls input:focus,
        .discount-controls select:focus {
            outline: none;
            border-color: #ffc107;
        }

        /* ==================== TOTAL SECTION ==================== */
        .total-section {
            text-align: right;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .total-row {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .total-row.discount-row {
            color: #28a745;
        }

        .total-row.grand-total {
            font-size: 22px;
            font-weight: bold;
            color: #667eea;
            border-top: 3px solid #667eea;
            padding-top: 15px;
            margin-top: 15px;
        }

        .total-in-words {
            text-align: right;
            font-style: italic;
            color: #666;
            margin-top: 10px;
            font-size: 14px;
        }

        /* ==================== BANK DETAILS SECTION ==================== */
        .bank-details-section {
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }

        .bank-details-section h4 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .bank-details-content {
            color: #333;
            line-height: 1.8;
            font-size: 14px;
        }

        .bank-details-content strong {
            color: #1976d2;
        }

        /* ==================== TERMS SECTION ==================== */
        .terms-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .terms-section h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .terms-section p {
            color: #666;
            line-height: 1.6;
            font-size: 14px;
        }

        /* ==================== SIGNATURE SECTION ==================== */
        .signature-section {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .signature-box {
            text-align: center;
            padding: 20px;
            min-width: 200px;
        }

        .signature-line {
            border-top: 2px solid #333;
            margin-top: 60px;
            padding-top: 10px;
            font-weight: 600;
        }

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            #billContainer {
                padding: 20px;
            }

            .company-name {
                font-size: 24px;
            }

            .header-content {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-buttons button {
                width: 100%;
            }

            .bill-info {
                grid-template-columns: 1fr;
            }

            .items-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .total-row {
                font-size: 14px;
            }

            .total-row.grand-total {
                font-size: 18px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }

            .gst-input-group,
            .discount-controls {
                grid-template-columns: 1fr;
            }

            .signature-section {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .login-box {
                padding: 25px;
            }

            .company-name {
                font-size: 20px;
            }

            #billContainer {
                padding: 15px;
            }

            .items-table th,
            .items-table td {
                padding: 8px;
                font-size: 12px;
            }
        }

        @media print {
            body {
                background: white;
            }

            header,
            .company-selector,
            .gst-settings,
            button {
                display: none !important;
            }

            #billContainer {
                box-shadow: none;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ==================== LOGIN SCREEN ==================== -->
    <div id="loginScreen">
        <div class="login-box">
            <h2>🔐 Secure Login</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">
                Enter password to access billing system
            </p>
            <input 
                type="password" 
                id="passwordInput" 
                placeholder="Enter Password"
                onkeypress="if(event.key === 'Enter') login()"
            >
            <button onclick="login()">Login</button>
            <p class="error-message" id="errorMessage"></p>
            <p style="text-align: center; color: #999; margin-top: 20px; font-size: 12px;">
                Default password: <strong>admin123</strong>
            </p>
        </div>
    </div>

    <!-- ==================== EDIT COMPANY MODAL ==================== -->
    <div id="editCompanyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>✏️ Edit Company Details</h2>
                <span class="close-modal" onclick="closeEditModal()">&times;</span>
            </div>
            
            <div class="form-group">
                <label>Company Logo URL:</label>
                <input type="text" id="editLogoUrl" placeholder="https://example.com/logo.png">
                <small>Enter a direct link to your company logo image</small>
                <div class="logo-preview" id="logoPreview"></div>
            </div>
            
            <div class="form-group">
                <label>Company Name: *</label>
                <input type="text" id="editCompanyName" placeholder="Enter company name">
            </div>
            
            <div class="form-group">
                <label>Address: *</label>
                <input type="text" id="editAddress" placeholder="Enter address">
            </div>
            
            <div class="form-group">
                <label>Phone: *</label>
                <input type="text" id="editPhone" placeholder="Enter phone number">
            </div>
            
            <div class="form-group">
                <label>Email: *</label>
                <input type="email" id="editEmail" placeholder="Enter email">
            </div>
            
            <div class="form-group">
                <label>GSTIN:</label>
                <input type="text" id="editGSTIN" placeholder="Enter GSTIN">
            </div>
            
            <div class="form-group">
                <label>PAN:</label>
                <input type="text" id="editPAN" placeholder="Enter PAN">
            </div>

            <div class="form-group">
                <label>Bank Name:</label>
                <input type="text" id="editBankName" placeholder="Enter bank name">
            </div>

            <div class="form-group">
                <label>Account Number:</label>
                <input type="text" id="editAccountNumber" placeholder="Enter account number">
            </div>

            <div class="form-group">
                <label>IFSC Code:</label>
                <input type="text" id="editIFSC" placeholder="Enter IFSC code">
            </div>

            <div class="form-group">
                <label>Branch:</label>
                <input type="text" id="editBranch" placeholder="Enter branch name">
            </div>

            <div class="form-group">
                <label>Authorized Signature Image URL:</label>
                <input type="text" id="editSignatureUrl" placeholder="https://example.com/signature.png">
                <small>Upload your signature image and paste the URL here</small>
                <div class="logo-preview" id="signaturePreview"></div>
            </div>
            
            <button class="btn-success" style="width: 100%; padding: 15px; font-size: 16px;" onclick="saveCompanyDetails()">
                💾 Save Changes
            </button>
        </div>
    </div>

    <!-- ==================== MAIN APPLICATION ==================== -->
    <div id="mainApp">
        <header>
            <div class="header-content">
                <div class="logo">📊 Indian Billing System</div>
                <div class="nav-buttons">
                    <button class="btn-primary" onclick="exportPDF()">📄 Download PDF</button>
                    <button class="btn-secondary" onclick="printBill()">🖨️ Print Bill</button>
                    <button class="btn-secondary" onclick="logout()">🚪 Logout</button>
                </div>
            </div>
        </header>

        <!-- Company Selector Section -->
        <div class="company-selector">
            <div class="company-selector-header">
                <h3>Select Company</h3>
                <button class="btn-success" onclick="openEditModal()">✏️ Edit Company</button>
            </div>
            <select id="companySelect" onchange="switchCompany()">
                <option value="company1">Tech Solutions Pvt. Ltd.</option>
                <option value="company2">Global Traders India</option>
                <option value="company3">Innovative Services Co.</option>
            </select>
        </div>

        <!-- GST Settings Section -->
        <div class="gst-settings">
            <h3>⚙️ GST Settings</h3>
            <div class="gst-input-group">
                <div>
                    <label>CGST Percentage (%):</label>
                    <input type="number" id="cgstPercent" value="9" min="0" max="100" step="0.01" onchange="calculateTotal()">
                </div>
                <div>
                    <label>SGST Percentage (%):</label>
                    <input type="number" id="sgstPercent" value="9" min="0" max="100" step="0.01" onchange="calculateTotal()">
                </div>
                <div>
                    <label>IGST Percentage (%):</label>
                    <input type="number" id="igstPercent" value="18" min="0" max="100" step="0.01" onchange="calculateTotal()">
                </div>
            </div>
        </div>

        <!-- Bill Container -->
        <div id="billContainer">
            <!-- Company Header -->
            <div class="company-header">
                <img id="companyLogo" class="company-logo" style="display: none;" alt="Company Logo">
                <div class="company-name" id="companyName">Tech Solutions Pvt. Ltd.</div>
                <div class="company-details" id="companyDetails">
                    123, MG Road, Bangalore - 560001, Karnataka, India<br>
                    Phone: +91-80-12345678 | Email: info@techsolutions.in<br>
                    GSTIN: 29ABCDE1234F1Z5 | PAN: ABCDE1234F
                </div>
            </div>

            <!-- Bill Information Section -->
            <div class="bill-info">
                <div class="info-group">
                    <label>Invoice Number:</label>
                    <input type="text" id="invoiceNumber" value="INV-2024-001">
                </div>
                <div class="info-group">
                    <label>Invoice Date:</label>
                    <input type="date" id="invoiceDate">
                </div>
                <div class="info-group">
                    <label>Due Date:</label>
                    <input type="date" id="dueDate">
                </div>
            </div>

            <!-- Customer Details Section -->
            <div class="customer-section">
                <h3>Bill To:</h3>
                <div class="bill-info">
                    <div class="info-group">
                        <label>Customer Name:</label>
                        <input type="text" id="customerName" placeholder="Enter customer name">
                    </div>
                    <div class="info-group">
                        <label>Customer Address:</label>
                        <input type="text" id="customerAddress" placeholder="Enter address">
                    </div>
                    <div class="info-group">
                        <label>Customer GSTIN:</label>
                        <input type="text" id="customerGSTIN" placeholder="Enter GSTIN (optional)">
                    </div>
                    <div class="info-group">
                        <label>Customer Phone:</label>
                        <input type="text" id="customerPhone" placeholder="Enter phone number">
                    </div>
                </div>
            </div>

            <!-- Items Table -->
            <table class="items-table" id="itemsTable">
                <thead>
                    <tr>
                        <th style="width: 5%;">S.No</th>
                        <th style="width: 30%;">Description</th>
                        <th style="width: 10%;">HSN/SAC</th>
                        <th style="width: 10%;">Quantity</th>
                        <th style="width: 12%;">Rate (₹)</th>
                        <th style="width: 10%;">Disc %</th>
                        <th style="width: 13%;">Amount (₹)</th>
                        <th style="width: 10%;">Action</th>
                    </tr>
                </thead>
                <tbody id="itemsTableBody">
                </tbody>
            </table>
            <button class="btn-add-item" onclick="addItem()">+ Add Item</button>

            <!-- Discount Section -->
            <div class="discount-section">
                <h4>💰 Additional Discount</h4>
                <div class="discount-controls">
                    <div>
                        <label>Discount Type:</label>
                        <select id="discountType" onchange="calculateTotal()">
                            <option value="none">No Discount</option>
                            <option value="percentage">Percentage (%)</option>
                            <option value="fixed">Fixed Amount (₹)</option>
                        </select>
                    </div>
                    <div>
                        <label>Discount Value:</label>
                        <input type="number" id="discountValue" value="0" min="0" step="0.01" onchange="calculateTotal()">
                    </div>
                </div>
            </div>

            <!-- Total Section -->
            <div class="total-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span>₹ <span id="subtotal">0.00</span></span>
                </div>
                <div class="total-row discount-row" id="itemDiscountRow" style="display: none;">
                    <span>Item Discount:</span>
                    <span>- ₹ <span id="itemDiscount">0.00</span></span>
                </div>
                <div class="total-row" id="taxableAmountRow">
                    <span>Taxable Amount:</span>
                    <span>₹ <span id="taxableAmount">0.00</span></span>
                </div>
                <div class="total-row" id="cgstRow">
                    <span>CGST (<span id="cgstLabel">9</span>%):</span>
                    <span>₹ <span id="cgst">0.00</span></span>
                </div>
                <div class="total-row" id="sgstRow">
                    <span>SGST (<span id="sgstLabel">9</span>%):</span>
                    <span>₹ <span id="sgst">0.00</span></span>
                </div>
                <div class="total-row" id="igstRow" style="display: none;">
                    <span>IGST (<span id="igstLabel">18</span>%):</span>
                    <span>₹ <span id="igst">0.00</span></span>
                </div>
                <div class="total-row discount-row" id="additionalDiscountRow" style="display: none;">
                    <span>Additional Discount:</span>
                    <span>- ₹ <span id="additionalDiscount">0.00</span></span>
                </div>
                <div class="total-row grand-total">
                    <span>Grand Total:</span>
                    <span>₹ <span id="grandTotal">0.00</span></span>
                </div>
                <div class="total-in-words">
                    <strong>Amount in Words:</strong> <span id="totalInWords">Zero Rupees Only</span>
                </div>
            </div>

            <!-- Bank Details Section -->
            <div class="bank-details-section" id="bankDetailsSection">
                <h4>🏦 Bank Details for Payment</h4>
                <div class="bank-details-content" id="bankDetailsContent">
                    <p><strong>Bank Name:</strong> <span id="displayBankName">Not Available</span></p>
                    <p><strong>Account Number:</strong> <span id="displayAccountNumber">Not Available</span></p>
                    <p><strong>IFSC Code:</strong> <span id="displayIFSC">Not Available</span></p>
                    <p><strong>Branch:</strong> <span id="displayBranch">Not Available</span></p>
                </div>
            </div>

            <!-- Terms & Conditions -->
            <div class="terms-section">
                <h4>Terms & Conditions:</h4>
                <p>
                    1. Payment is due within 30 days of invoice date.<br>
                    2. Please make checks payable to the company name mentioned above.<br>
                    3. Interest @18% p.a. will be charged on overdue amounts.<br>
                    4. All disputes subject to jurisdiction mentioned in company details.<br>
                    5. Goods once sold cannot be returned or exchanged.
                </p>
            </div>

            <!-- Signature Section -->
            <div class="signature-section">
                <div class="signature-box" style="margin-left: auto;">
                    <img id="authorizedSignature" class="authorized-signature-img" style="display: none; max-width: 200px; max-height: 80px; margin-bottom: 10px;" alt="Authorized Signature">
                    <div class="signature-line">Authorized Signatory</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        const PASSWORD = "admin123";
        let itemCounter = 0;

        // Company data with bank details and signature
        let companies = {
            company1: {
                name: "Tech Solutions Pvt. Ltd.",
                address: "123, MG Road, Bangalore - 560001, Karnataka, India",
                phone: "+91-80-12345678",
                email: "info@techsolutions.in",
                gstin: "29ABCDE1234F1Z5",
                pan: "ABCDE1234F",
                logo: "",
                bankName: "State Bank of India",
                accountNumber: "1234567890",
                ifsc: "SBIN0001234",
                branch: "MG Road, Bangalore",
                signature: ""
            },
            company2: {
                name: "Global Traders India",
                address: "456, Nehru Place, New Delhi - 110019, Delhi, India",
                phone: "+91-11-98765432",
                email: "contact@globaltraders.in",
                gstin: "07XYZAB5678G1Z3",
                pan: "XYZAB5678G",
                logo: "",
                bankName: "HDFC Bank",
                accountNumber: "9876543210",
                ifsc: "HDFC0005678",
                branch: "Nehru Place, Delhi",
                signature: ""
            },
            company3: {
                name: "Innovative Services Co.",
                address: "789, Andheri West, Mumbai - 400058, Maharashtra, India",
                phone: "+91-22-55667788",
                email: "support@innovative.in",
                gstin: "27PQRST9012H1Z1",
                pan: "PQRST9012H",
                logo: "",
                bankName: "ICICI Bank",
                accountNumber: "5555666677",
                ifsc: "ICIC0009012",
                branch: "Andheri West, Mumbai",
                signature: ""
            }
        };

        // ==================== NUMBER TO WORDS CONVERSION ====================
        function numberToWords(num) {
            if (num === 0) return "Zero Rupees Only";
            
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            
            function convertHundreds(n) {
                let str = '';
                if (n > 99) {
                    str += ones[Math.floor(n / 100)] + ' Hundred ';
                    n %= 100;
                }
                if (n > 19) {
                    str += tens[Math.floor(n / 10)] + ' ';
                    n %= 10;
                }
                if (n > 9) {
                    str += teens[n - 10] + ' ';
                    return str.trim();
                }
                if (n > 0) {
                    str += ones[n] + ' ';
                }
                return str.trim();
            }
            
            let [rupees, paise] = num.toFixed(2).split('.');
            rupees = parseInt(rupees);
            paise = parseInt(paise);
            
            let result = '';
            
            if (rupees >= 10000000) {
                result += convertHundreds(Math.floor(rupees / 10000000)) + ' Crore ';
                rupees %= 10000000;
            }
            
            if (rupees >= 100000) {
                result += convertHundreds(Math.floor(rupees / 100000)) + ' Lakh ';
                rupees %= 100000;
            }
            
            if (rupees >= 1000) {
                result += convertHundreds(Math.floor(rupees / 1000)) + ' Thousand ';
                rupees %= 1000;
            }
            
            if (rupees > 0) {
                result += convertHundreds(rupees);
            }
            
            result = result.trim() + ' Rupees';
            
            if (paise > 0) {
                result += ' and ' + convertHundreds(paise) + ' Paise';
            }
            
            return result + ' Only';
        }

        // ==================== LOGIN FUNCTIONALITY ====================
        function login() {
            const passwordInput = document.getElementById('passwordInput').value;
            const errorMessage = document.getElementById('errorMessage');
            
            if (passwordInput === PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                setDefaultDates();
                addItem();
                updateCompanyDisplay();
            } else {
                errorMessage.textContent = '❌ Incorrect password. Please try again.';
                document.getElementById('passwordInput').value = '';
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('passwordInput').value = '';
                document.getElementById('errorMessage').textContent = '';
            }
        }

        // ==================== COMPANY MANAGEMENT ====================
        function openEditModal() {
            const selectedCompany = document.getElementById('companySelect').value;
            const companyData = companies[selectedCompany];
            
            document.getElementById('editLogoUrl').value = companyData.logo || '';
            document.getElementById('editCompanyName').value = companyData.name;
            document.getElementById('editAddress').value = companyData.address;
            document.getElementById('editPhone').value = companyData.phone;
            document.getElementById('editEmail').value = companyData.email;
            document.getElementById('editGSTIN').value = companyData.gstin;
            document.getElementById('editPAN').value = companyData.pan;
            document.getElementById('editBankName').value = companyData.bankName || '';
            document.getElementById('editAccountNumber').value = companyData.accountNumber || '';
            document.getElementById('editIFSC').value = companyData.ifsc || '';
            document.getElementById('editBranch').value = companyData.branch || '';
            document.getElementById('editSignatureUrl').value = companyData.signature || '';
            
            if (companyData.logo) {
                document.getElementById('logoPreview').innerHTML = 
                    `<img src="${companyData.logo}" alt="Logo Preview" style="max-width: 150px; max-height: 150px; border: 2px solid #e0e0e0; border-radius: 8px; padding: 10px; margin-top: 10px;">`;
            } else {
                document.getElementById('logoPreview').innerHTML = '';
            }

            if (companyData.signature) {
                document.getElementById('signaturePreview').innerHTML = 
                    `<img src="${companyData.signature}" alt="Signature Preview" style="max-width: 200px; max-height: 80px; border: 2px solid #e0e0e0; border-radius: 8px; padding: 10px; margin-top: 10px;">`;
            } else {
                document.getElementById('signaturePreview').innerHTML = '';
            }
            
            document.getElementById('editCompanyModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editCompanyModal').style.display = 'none';
        }

        function saveCompanyDetails() {
            const selectedCompany = document.getElementById('companySelect').value;
            
            const logoUrl = document.getElementById('editLogoUrl').value.trim();
            const name = document.getElementById('editCompanyName').value.trim();
            const address = document.getElementById('editAddress').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const gstin = document.getElementById('editGSTIN').value.trim();
            const pan = document.getElementById('editPAN').value.trim();
            const bankName = document.getElementById('editBankName').value.trim();
            const accountNumber = document.getElementById('editAccountNumber').value.trim();
            const ifsc = document.getElementById('editIFSC').value.trim();
            const branch = document.getElementById('editBranch').value.trim();
            const signatureUrl = document.getElementById('editSignatureUrl').value.trim();
            
            if (!name || !address || !phone || !email) {
                alert('⚠️ Please fill in all required fields (Name, Address, Phone, Email)');
                return;
            }
            
            companies[selectedCompany] = {
                name: name,
                address: address,
                phone: phone,
                email: email,
                gstin: gstin,
                pan: pan,
                logo: logoUrl,
                bankName: bankName,
                accountNumber: accountNumber,
                ifsc: ifsc,
                branch: branch,
                signature: signatureUrl
            };
            
            updateCompanyDisplay();
            closeEditModal();
            alert('✅ Company details updated successfully!');
        }

        function updateCompanyDisplay() {
            const selectedCompany = document.getElementById('companySelect').value;
            const companyData = companies[selectedCompany];
            
            document.getElementById('companyName').textContent = companyData.name;
            
            const detailsHTML = `
                ${companyData.address}<br>
                Phone: ${companyData.phone} | Email: ${companyData.email}<br>
                GSTIN: ${companyData.gstin} | PAN: ${companyData.pan}
            `;
            document.getElementById('companyDetails').innerHTML = detailsHTML;
            
            const logoElement = document.getElementById('companyLogo');
            if (companyData.logo) {
                logoElement.src = companyData.logo;
                logoElement.style.display = 'block';
            } else {
                logoElement.style.display = 'none';
            }

            // Update bank details display
            if (companyData.bankName && companyData.accountNumber) {
                document.getElementById('displayBankName').textContent = companyData.bankName;
                document.getElementById('displayAccountNumber').textContent = companyData.accountNumber;
                document.getElementById('displayIFSC').textContent = companyData.ifsc || 'Not Available';
                document.getElementById('displayBranch').textContent = companyData.branch || 'Not Available';
                document.getElementById('bankDetailsSection').style.display = 'block';
            } else {
                document.getElementById('bankDetailsSection').style.display = 'none';
            }

            // Update signature display
            const signatureElement = document.getElementById('authorizedSignature');
            if (companyData.signature) {
                signatureElement.src = companyData.signature;
                signatureElement.style.display = 'block';
            } else {
                signatureElement.style.display = 'none';
            }
        }

        function switchCompany() {
            updateCompanyDisplay();
        }

        // ==================== DATE INITIALIZATION ====================
        function setDefaultDates() {
            const today = new Date();
            const dueDate = new Date();
            dueDate.setDate(today.getDate() + 30);
            
            document.getElementById('invoiceDate').value = today.toISOString().split('T')[0];
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
        }

        // ==================== ITEM MANAGEMENT ====================
        function addItem() {
            itemCounter++;
            const tableBody = document.getElementById('itemsTableBody');
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${itemCounter}</td>
                <td><input type="text" placeholder="Item description" oninput="calculateTotal()"></td>
                <td><input type="text" placeholder="HSN/SAC code"></td>
                <td><input type="number" value="1" min="1" oninput="calculateTotal()"></td>
                <td><input type="number" value="0" min="0" step="0.01" oninput="calculateTotal()"></td>
                <td><input type="number" value="0" min="0" max="100" step="0.01" oninput="calculateTotal()" placeholder="0"></td>
                <td>₹ <span class="item-amount">0.00</span></td>
                <td><button class="btn-remove" onclick="removeItem(this)">Remove</button></td>
            `;
            
            tableBody.appendChild(row);
        }

        function removeItem(button) {
            const row = button.closest('tr');
            row.remove();
            updateSerialNumbers();
            calculateTotal();
        }

        function updateSerialNumbers() {
            const rows = document.querySelectorAll('#itemsTableBody tr');
            rows.forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
            itemCounter = rows.length;
        }

        // ==================== CALCULATION FUNCTIONS ====================
        function calculateTotal() {
            const rows = document.querySelectorAll('#itemsTableBody tr');
            let subtotal = 0;
            let totalItemDiscount = 0;
            
            // Calculate amount for each item with individual discount
            rows.forEach(row => {
                const quantity = parseFloat(row.cells[3].querySelector('input').value) || 0;
                const rate = parseFloat(row.cells[4].querySelector('input').value) || 0;
                const discountPercent = parseFloat(row.cells[5].querySelector('input').value) || 0;
                
                const itemTotal = quantity * rate;
                const itemDiscountAmount = itemTotal * (discountPercent / 100);
                const itemAmount = itemTotal - itemDiscountAmount;
                
                row.cells[6].querySelector('.item-amount').textContent = itemAmount.toFixed(2);
                subtotal += itemTotal;
                totalItemDiscount += itemDiscountAmount;
            });
            
            // Show/hide item discount row
            if (totalItemDiscount > 0) {
                document.getElementById('itemDiscountRow').style.display = 'flex';
                document.getElementById('itemDiscount').textContent = totalItemDiscount.toFixed(2);
            } else {
                document.getElementById('itemDiscountRow').style.display = 'none';
            }
            
            // Calculate taxable amount after item discounts
            const taxableAmountAfterItemDiscount = subtotal - totalItemDiscount;
            
            // Get GST percentages
            const cgstPercent = parseFloat(document.getElementById('cgstPercent').value) || 0;
            const sgstPercent = parseFloat(document.getElementById('sgstPercent').value) || 0;
            
            // Calculate GST
            const cgst = taxableAmountAfterItemDiscount * (cgstPercent / 100);
            const sgst = taxableAmountAfterItemDiscount * (sgstPercent / 100);
            
            // Calculate total before additional discount
            let totalBeforeAdditionalDiscount = taxableAmountAfterItemDiscount + cgst + sgst;
            
            // Apply additional discount
            const discountType = document.getElementById('discountType').value;
            const discountValue = parseFloat(document.getElementById('discountValue').value) || 0;
            let additionalDiscountAmount = 0;
            
            if (discountType === 'percentage') {
                additionalDiscountAmount = totalBeforeAdditionalDiscount * (discountValue / 100);
            } else if (discountType === 'fixed') {
                additionalDiscountAmount = discountValue;
            }
            
            // Show/hide additional discount row
            if (additionalDiscountAmount > 0) {
                document.getElementById('additionalDiscountRow').style.display = 'flex';
                document.getElementById('additionalDiscount').textContent = additionalDiscountAmount.toFixed(2);
            } else {
                document.getElementById('additionalDiscountRow').style.display = 'none';
            }
            
            // Calculate final grand total
            const grandTotal = totalBeforeAdditionalDiscount - additionalDiscountAmount;
            
            // Update all displays
            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('taxableAmount').textContent = taxableAmountAfterItemDiscount.toFixed(2);
            document.getElementById('cgst').textContent = cgst.toFixed(2);
            document.getElementById('sgst').textContent = sgst.toFixed(2);
            document.getElementById('grandTotal').textContent = grandTotal.toFixed(2);
            
            // Update GST labels
            document.getElementById('cgstLabel').textContent = cgstPercent.toFixed(2);
            document.getElementById('sgstLabel').textContent = sgstPercent.toFixed(2);
            
            // Convert total to words
            document.getElementById('totalInWords').textContent = numberToWords(grandTotal);
        }

        // ==================== PRINT FUNCTIONALITY ====================
        function printBill() {
            window.print();
        }

        // ==================== PDF EXPORT FUNCTIONALITY ====================
        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const selectedCompany = document.getElementById('companySelect').value;
            const companyData = companies[selectedCompany];
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const invoiceDate = document.getElementById('invoiceDate').value;
            const customerName = document.getElementById('customerName').value;
            
            let yPosition = 20;
            
            // Company name
            doc.setFontSize(20);
            doc.setTextColor(102, 126, 234);
            doc.text(companyData.name, 105, yPosition, { align: 'center' });
            yPosition += 10;
            
            // Company details
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(companyData.address, 105, yPosition, { align: 'center' });
            yPosition += 5;
            doc.text(`Phone: ${companyData.phone} | Email: ${companyData.email}`, 105, yPosition, { align: 'center' });
            yPosition += 5;
            doc.text(`GSTIN: ${companyData.gstin} | PAN: ${companyData.pan}`, 105, yPosition, { align: 'center' });
            yPosition += 10;
            
            // Line separator
            doc.setDrawColor(102, 126, 234);
            doc.setLineWidth(0.5);
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 10;
            
            // Invoice information
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Invoice #: ${invoiceNumber}`, 20, yPosition);
            doc.text(`Date: ${invoiceDate}`, 150, yPosition);
            yPosition += 10;
            
            // Customer information
            doc.text(`Bill To: ${customerName}`, 20, yPosition);
            yPosition += 5;
            doc.setFontSize(10);
            doc.text(`Address: ${document.getElementById('customerAddress').value}`, 20, yPosition);
            yPosition += 5;
            doc.text(`Phone: ${document.getElementById('customerPhone').value}`, 20, yPosition);
            yPosition += 15;
            
            // Items table header
            doc.setFillColor(102, 126, 234);
            doc.rect(20, yPosition, 170, 8, 'F');
            doc.setTextColor(255, 255, 255);
            doc.text('Item', 25, yPosition + 6);
            doc.text('Qty', 110, yPosition + 6);
            doc.text('Rate', 130, yPosition + 6);
            doc.text('Disc%', 150, yPosition + 6);
            doc.text('Amount', 170, yPosition + 6);
            yPosition += 8;
            
            // Items
            doc.setTextColor(0, 0, 0);
            const rows = document.querySelectorAll('#itemsTableBody tr');
            rows.forEach(row => {
                yPosition += 6;
                const description = row.cells[1].querySelector('input').value;
                const quantity = row.cells[3].querySelector('input').value;
                const rate = row.cells[4].querySelector('input').value;
                const disc = row.cells[5].querySelector('input').value;
                const amount = row.cells[6].querySelector('.item-amount').textContent;
                
                doc.text(description.substring(0, 35), 25, yPosition);
                doc.text(quantity, 115, yPosition);
                doc.text(rate, 135, yPosition);
                doc.text(disc, 155, yPosition);
                doc.text(amount, 175, yPosition);
            });
            
            // Totals
            yPosition += 10;
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 8;
            
            const subtotal = document.getElementById('subtotal').textContent;
            const itemDiscount = document.getElementById('itemDiscount').textContent;
            const taxableAmount = document.getElementById('taxableAmount').textContent;
            const cgst = document.getElementById('cgst').textContent;
            const sgst = document.getElementById('sgst').textContent;
            const additionalDiscount = document.getElementById('additionalDiscount').textContent;
            const grandTotal = document.getElementById('grandTotal').textContent;
            
            doc.text('Subtotal:', 140, yPosition);
            doc.text(`₹ ${subtotal}`, 175, yPosition);
            yPosition += 5;
            
            if (document.getElementById('itemDiscountRow').style.display !== 'none') {
                doc.setTextColor(40, 167, 69);
                doc.text('Item Discount:', 140, yPosition);
                doc.text(`- ₹ ${itemDiscount}`, 175, yPosition);
                yPosition += 5;
                doc.setTextColor(0, 0, 0);
            }
            
            doc.text('Taxable Amount:', 140, yPosition);
            doc.text(`₹ ${taxableAmount}`, 175, yPosition);
            yPosition += 5;
            
            const cgstPercent = document.getElementById('cgstPercent').value;
            const sgstPercent = document.getElementById('sgstPercent').value;
            
            doc.text(`CGST (${cgstPercent}%):`, 140, yPosition);
            doc.text(`₹ ${cgst}`, 175, yPosition);
            yPosition += 5;
            
            doc.text(`SGST (${sgstPercent}%):`, 140, yPosition);
            doc.text(`₹ ${sgst}`, 175, yPosition);
            yPosition += 5;
            
            if (document.getElementById('additionalDiscountRow').style.display !== 'none') {
                doc.setTextColor(40, 167, 69);
                doc.text('Add. Discount:', 140, yPosition);
                doc.text(`- ₹ ${additionalDiscount}`, 175, yPosition);
                yPosition += 5;
                doc.setTextColor(0, 0, 0);
            }
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('Grand Total:', 140, yPosition);
            doc.text(`₹ ${grandTotal}`, 175, yPosition);
            yPosition += 8;
            
            // Total in words
            doc.setFontSize(9);
            doc.setFont(undefined, 'italic');
            const totalWords = document.getElementById('totalInWords').textContent;
            const wordsLines = doc.splitTextToSize(`Amount in Words: ${totalWords}`, 170);
            doc.text(wordsLines, 20, yPosition);
            yPosition += (wordsLines.length * 4) + 5;
            
            // Bank details
            if (companyData.bankName && companyData.accountNumber) {
                yPosition += 5;
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(33, 150, 243);
                doc.text('Bank Details:', 20, yPosition);
                yPosition += 5;
                doc.setFont(undefined, 'normal');
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(9);
                doc.text(`Bank: ${companyData.bankName}`, 20, yPosition);
                yPosition += 4;
                doc.text(`Account: ${companyData.accountNumber}`, 20, yPosition);
                yPosition += 4;
                doc.text(`IFSC: ${companyData.ifsc}`, 20, yPosition);
                yPosition += 4;
                doc.text(`Branch: ${companyData.branch}`, 20, yPosition);
                yPosition += 8;
            }
            
            // Terms
            yPosition += 5;
            doc.setFontSize(9);
            doc.setFont(undefined, 'bold');
            doc.text('Terms & Conditions:', 20, yPosition);
            yPosition += 4;
            doc.setFont(undefined, 'normal');
            doc.setFontSize(8);
            doc.text('1. Payment due within 30 days. 2. Interest @18% p.a. on overdue amounts.', 20, yPosition);
            yPosition += 4;
            doc.text('3. Goods once sold cannot be returned.', 20, yPosition);
            
            // Save PDF
            doc.save(`Invoice_${invoiceNumber}_${customerName.replace(/\s+/g, '_')}.pdf`);
        }

        // ==================== MODAL CLOSE ON OUTSIDE CLICK ====================
        window.onclick = function(event) {
            const modal = document.getElementById('editCompanyModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').focus();
            
            // Logo preview in edit modal
            const logoInput = document.getElementById('editLogoUrl');
            if (logoInput) {
                logoInput.addEventListener('input', function() {
                    const url = this.value.trim();
                    const preview = document.getElementById('logoPreview');
                    
                    if (url) {
                        preview.innerHTML = `<img src="${url}" alt="Logo Preview" style="max-width: 150px; max-height: 150px; border: 2px solid #e0e0e0; border-radius: 8px; padding: 10px; margin-top: 10px;" onerror="this.parentElement.innerHTML='<p style=color:red;margin-top:10px;>Invalid image URL</p>'">`;
                    } else {
                        preview.innerHTML = '';
                    }
                });
            }

            // Signature preview in edit modal
            const signatureInput = document.getElementById('editSignatureUrl');
            if (signatureInput) {
                signatureInput.addEventListener('input', function() {
                    const url = this.value.trim();
                    const preview = document.getElementById('signaturePreview');
                    
                    if (url) {
                        preview.innerHTML = `<img src="${url}" alt="Signature Preview" style="max-width: 200px; max-height: 80px; border: 2px solid #e0e0e0; border-radius: 8px; padding: 10px; margin-top: 10px;" onerror="this.parentElement.innerHTML='<p style=color:red;margin-top:10px;>Invalid image URL</p>'">`;
                    } else {
                        preview.innerHTML = '';
                    }
                });
            }
        });
    </script>
</body>
</html>